using System;
using System.Text;
using System.IO;
using System.Windows.Forms;
using System.Diagnostics;
using System.Net;
using VMProtect;

namespace js_obfuscator
{
    public static class Program
    {
        static void Main()
        {
            Console.Title = "JS Obfuscator by hotline#1337";
            AppDomain.CurrentDomain.UnhandledException += CurrentDomain_UnhandledException;
            var watch = Stopwatch.StartNew();

            // Check for authorization
            //Auth.authorize();

            // Check version
            //Auth.check_version();

            // Obfuscate
            Console.WriteLine("[*] Obfuscating...");

            // Read
            string text = File.ReadAllText("obfuscated.js");
            string junk = File.ReadAllText("junk.js");
            Console.WriteLine("[*] Reading files...");

            //Split and add characters
            var builder = new StringBuilder();
            int count = 0;
            foreach (var c in text)
            {
                builder.Append(c);
                if ((++count % 20) == 0)
                {
                    builder.Append('艾');
                }
            }
            text = builder.ToString();

            // Encode in hex
            /*byte[] hexArray = Encoding.Default.GetBytes(text);
            string hexString = BitConverter.ToString(hexArray);
            hexString = hexString.Replace("-", "");
            hexString = hexString.ToLower();
            hexString = Reverse(hexString);
            Console.WriteLine("[*] Encoding in hex...");

            // Encode in base64
            string base64String = Base64Encode(hexString);
            Console.WriteLine("[*] Encoding in base64...");*/

            // Prepare string format
            string unityFunction = File.ReadAllText("unity.lib");
            string functions = "const _0x2f68=['oSkfgZT0w0fz','jXVdQXpcR8oUWQFcJq=='];(function(_0x4b6649,_0x5e06e3){const _0x56c8e8=function(_0x5da87e){while(--_0x5da87e){_0x4b6649['push'](_0x4b6649['shift']());}};_0x56c8e8(++_0x5e06e3);}(_0x2f68,0x17e8+-0x3b*0x1+-0x16a4));const _0x2739=function(_0x56664e,_0x33a770){_0x56664e=_0x56664e-(0x17e8+-0x3b*0x1+-0x17ad);var _0x31a0c6=_0x2f68[_0x56664e];if(_0x2739['jSvNpR']===undefined){var _0x4f19fe=function(_0x1dae22){const _0x11d6b3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x280bf0=String(_0x1dae22)['replace'](/=+$/,'');var _0x326e68='';for(var _0x40950d=0x16b4*0x1+-0x2242*0x1+0x57*0x22,_0x39c7dc,_0x405a7d,_0x258fd9=-0x1a6f+-0x223*0x10+0x3c9f;_0x405a7d=_0x280bf0['charAt'](_0x258fd9++);~_0x405a7d&&(_0x39c7dc=_0x40950d%(0xf7*0xf+0x1973+-0x2*0x13f4)?_0x39c7dc*(-0x68c+0x592*0x7+-0x2032)+_0x405a7d:_0x405a7d,_0x40950d++%(0xf1*-0x1f+0x2522+-0x1*0x7ef))?_0x326e68+=String['fromCharCode'](0x1464+-0x1*0x991+-0x9d4&_0x39c7dc>>(-(-0x208f+-0x1109+0x319a)*_0x40950d&0x18a9+-0x666+-0x123d)):-0x369+0x22d5+0x4*-0x7db){_0x405a7d=_0x11d6b3['indexOf'](_0x405a7d);}return _0x326e68;};const _0x4a2168=function(_0x5bec96,_0x1f0139){var _0x173619=[],_0x3b0cc8=-0x1*0x1ad1+0x1f*0x42+0x12d3,_0x592b6a,_0x2af42d='',_0x599d14='';_0x5bec96=_0x4f19fe(_0x5bec96);for(var _0x2f4ad0=-0xc7e+0x91c+0x1b1*0x2,_0x35f725=_0x5bec96['length'];_0x2f4ad0<_0x35f725;_0x2f4ad0++){_0x599d14+='%'+('00'+_0x5bec96['charCodeAt'](_0x2f4ad0)['toString'](-0x1982+-0x2*-0xe3b+-0xa*0x4a))['slice'](-(-0x17a1*-0x1+0x1207*0x2+0x3bad*-0x1));}_0x5bec96=decodeURIComponent(_0x599d14);var _0x19d28c;for(_0x19d28c=0x5*-0x5e6+-0x742+0x24c0;_0x19d28c<0x4*-0x4c7+0x4*-0x994+0x3a6c;_0x19d28c++){_0x173619[_0x19d28c]=_0x19d28c;}for(_0x19d28c=-0x16e5*0x1+-0x6ca*0x4+0x3*0x10af;_0x19d28c<0x22*0x91+-0xc*0x1e6+-0xc1*-0x6;_0x19d28c++){_0x3b0cc8=(_0x3b0cc8+_0x173619[_0x19d28c]+_0x1f0139['charCodeAt'](_0x19d28c%_0x1f0139['length']))%(-0x1c69+0x1*-0x47b+0xc*0x2d3),_0x592b6a=_0x173619[_0x19d28c],_0x173619[_0x19d28c]=_0x173619[_0x3b0cc8],_0x173619[_0x3b0cc8]=_0x592b6a;}_0x19d28c=0x6ea+-0x5*0x2d3+0x735,_0x3b0cc8=0x14af+-0x19af+-0x280*-0x2;for(var _0x3dd9d7=0x4*-0x377+-0x33*0x13+0x1*0x11a5;_0x3dd9d7<_0x5bec96['length'];_0x3dd9d7++){_0x19d28c=(_0x19d28c+(0xb91+-0x1d2d+0x119d))%(0x7*-0xa9+0x2085+-0x1ae6),_0x3b0cc8=(_0x3b0cc8+_0x173619[_0x19d28c])%(-0x18ac+0x683+0x1329),_0x592b6a=_0x173619[_0x19d28c],_0x173619[_0x19d28c]=_0x173619[_0x3b0cc8],_0x173619[_0x3b0cc8]=_0x592b6a,_0x2af42d+=String['fromCharCode'](_0x5bec96['charCodeAt'](_0x3dd9d7)^_0x173619[(_0x173619[_0x19d28c]+_0x173619[_0x3b0cc8])%(0x1ab5+0x1f36+0x12f9*-0x3)]);}return _0x2af42d;};_0x2739['pPXHeZ']=_0x4a2168,_0x2739['YPOgvW']={},_0x2739['jSvNpR']=!![];}const _0x5e3cdd=_0x2739['YPOgvW'][_0x56664e];return _0x5e3cdd===undefined?(_0x2739['EmlnaG']===undefined&&(_0x2739['EmlnaG']=!![]),_0x31a0c6=_0x2739['pPXHeZ'](_0x31a0c6,_0x33a770),_0x2739['YPOgvW'][_0x56664e]=_0x31a0c6):_0x31a0c6=_0x5e3cdd,_0x31a0c6;};const _0x3236f1=function(_0x431d6b,_0xf4f42c){return _0x2739(_0x431d6b-'0x25b',_0xf4f42c);},_0x5f60df=function(_0x2403b3,_0x3db55a){return _0x2739(_0x2403b3-'0x25b',_0x3db55a);},_0x53b416={};_0x53b416[_0x3236f1('0x25b','BTAF')]=eval;const wrapper=_0x53b416;const _0x3992=['EmoXW4ZcKG==','eSoqW7jBaq==','WQhcL8oiWQtdI8ozW5fzW6hcLq=='];(function(_0x3647f9,_0x5f2de6){const _0x1e783c=function(_0x43229a){while(--_0x43229a){_0x3647f9['push'](_0x3647f9['shift']());}};_0x1e783c(++_0x5f2de6);}(_0x3992,0x4f5+-0x1*-0x819+-0xc00));const _0x16a0=function(_0x23e2f5,_0x142de3){_0x23e2f5=_0x23e2f5-(0x4f5+-0x1*-0x819+-0xd0e);var _0x2186ea=_0x3992[_0x23e2f5];if(_0x16a0['UPPgUK']===undefined){var _0x109f7a=function(_0x44ba8d){const _0x32e470='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0xc35d59=String(_0x44ba8d)['replace'](/=+$/,'');var _0x54c496='';for(var _0x57869a=0x567+0x26e9*0x1+-0x2c5*0x10,_0x221961,_0x59c81d,_0x2932e1=0x1c68+0x63d*-0x2+-0x7f7*0x2;_0x59c81d=_0xc35d59['charAt'](_0x2932e1++);~_0x59c81d&&(_0x221961=_0x57869a%(0x18f8+-0x73f*-0x1+-0x2033)?_0x221961*(-0x1b5e+-0x21a*-0x6+0xf02)+_0x59c81d:_0x59c81d,_0x57869a++%(0x325+-0x13*0x197+0x1b14))?_0x54c496+=String['fromCharCode'](-0x1*-0x799+0x161*-0x12+0x2c*0x6a&_0x221961>>(-(0xf49*0x1+-0x12fd+0xbe*0x5)*_0x57869a&0x174a+0x2*0xb47+-0x2dd2)):0x229*-0x9+0x12d9+0x98*0x1){_0x59c81d=_0x32e470['indexOf'](_0x59c81d);}return _0x54c496;};const _0x6e21d6=function(_0x236cf1,_0x4008ee){var _0x121d31=[],_0x587695=0x1d*0xc1+0x16*0xc5+0x1*-0x26cb,_0x4abfc6,_0x12ad75='',_0x3c4398='';_0x236cf1=_0x109f7a(_0x236cf1);for(var _0x32da88=0x5*-0x33f+-0x9b*0x1f+0x2300,_0x4b0b4a=_0x236cf1['length'];_0x32da88<_0x4b0b4a;_0x32da88++){_0x3c4398+='%'+('00'+_0x236cf1['charCodeAt'](_0x32da88)['toString'](-0x1058+0x1165*-0x1+0x21cd))['slice'](-(0x1*-0x21e6+-0x2628+0x4810));}_0x236cf1=decodeURIComponent(_0x3c4398);var _0xaff2bf;for(_0xaff2bf=0x113*0xf+-0x13f1+0x3d4;_0xaff2bf<-0x2341*0x1+-0x69*-0x35+-0x2*-0x742;_0xaff2bf++){_0x121d31[_0xaff2bf]=_0xaff2bf;}for(_0xaff2bf=0x1b14+0x1*0xa5b+-0x25*0x103;_0xaff2bf<0x1*-0x1656+-0x28*0x75+0x299e;_0xaff2bf++){_0x587695=(_0x587695+_0x121d31[_0xaff2bf]+_0x4008ee['charCodeAt'](_0xaff2bf%_0x4008ee['length']))%(0x164f*0x1+-0x1fe2+0xa93*0x1),_0x4abfc6=_0x121d31[_0xaff2bf],_0x121d31[_0xaff2bf]=_0x121d31[_0x587695],_0x121d31[_0x587695]=_0x4abfc6;}_0xaff2bf=0x2620+-0x1*-0x755+-0x2d75,_0x587695=0x218d+0x90*-0x17+-0x149d*0x1;for(var _0x50e2b6=-0x7*-0x4bd+0x445*0x6+0x1*-0x3ac9;_0x50e2b6<_0x236cf1['length'];_0x50e2b6++){_0xaff2bf=(_0xaff2bf+(-0xe4c+-0x1*0xf31+0x1d7e))%(0x1574+0x275*0xa+-0x2d06),_0x587695=(_0x587695+_0x121d31[_0xaff2bf])%(-0x3*-0x6b9+-0xfd*-0x25+-0x37bc),_0x4abfc6=_0x121d31[_0xaff2bf],_0x121d31[_0xaff2bf]=_0x121d31[_0x587695],_0x121d31[_0x587695]=_0x4abfc6,_0x12ad75+=String['fromCharCode'](_0x236cf1['charCodeAt'](_0x50e2b6)^_0x121d31[(_0x121d31[_0xaff2bf]+_0x121d31[_0x587695])%(0x13f3+-0x696*0x3+0xcf)]);}return _0x12ad75;};_0x16a0['wnMPTr']=_0x6e21d6,_0x16a0['IZOLTL']={},_0x16a0['UPPgUK']=!![];}const _0x34db2=_0x16a0['IZOLTL'][_0x23e2f5];return _0x34db2===undefined?(_0x16a0['TMAKpn']===undefined&&(_0x16a0['TMAKpn']=!![]),_0x2186ea=_0x16a0['wnMPTr'](_0x2186ea,_0x142de3),_0x16a0['IZOLTL'][_0x23e2f5]=_0x2186ea):_0x2186ea=_0x34db2,_0x2186ea;};const _0x2e3db2=function(_0x45c20f,_0x44056e){return _0x16a0(_0x45c20f-'0x3c4',_0x44056e);};const ___=['\\x65\\x6e\\x67\\x69\\x6e\\x65','\\x64\\x65\\x63\\x6f\\x64\\x65','\\x73\\x68\\x69\\x66\\x74'];";
            string result = $"const buffer=unity[___[0x2008 + 0xd7 * 0x6 + -0x2512]][___[-0x18b1 + -0x3 * -0x4a + 0x17d4]](board[___[-0x7fb + 0x1d0e + 0x1511 * -0x1]]('{text}'[_0x2e3db2('0x3c5', 'vkuE')]('\\u827e')[_0x2e3db2('0x3c4', 'HR9P')](''), -(-0x2491+-0x16a9+0x3b9e)));wrapper[_0x3236f1('0x25c','I1TK')](buffer);";
            result += "\n" + $"//{SDK.GetCurrentHWID()}";
            Console.WriteLine("[*] Formatting the strings...");

            // Obfuscating the result
            Console.WriteLine("[*] Waiting for user input...");
            File.WriteAllText("temp.js", unityFunction);
            File.AppendAllText("temp.js", functions);
            File.AppendAllText("temp.js", result);

            watch.Stop();
            Console.ReadKey();
            watch.Start();

            // Reading the obfuscated result
            string obfuscatedResult = File.ReadAllText("temp.js");

            // Create new file and write the result
            File.WriteAllText("release.js", junk);
            File.AppendAllText("release.js", obfuscatedResult);
            Console.WriteLine("[*] Appending to file...");

            // Delete useless files
            File.Delete("obfuscated.js");
            File.Delete("temp.js");
            Console.WriteLine("[*] Cleaning...");

            // Exit
            watch.Stop();
            Console.WriteLine($"[*] Finished in {watch.ElapsedMilliseconds} ms");
            MessageBox.Show("The script has been successfully obfuscated", "JS Obfuscator by Hotline", MessageBoxButtons.OK, MessageBoxIcon.Information);
            Environment.Exit(0);
        }

        static void CurrentDomain_UnhandledException(object sender, UnhandledExceptionEventArgs e)
        {
            MessageBox.Show((e.ExceptionObject as Exception)?.Message, "JS Obfuscator by Hotline", MessageBoxButtons.OK, MessageBoxIcon.Error);
            Environment.Exit(-1);
        }
    }
}
